{% extends "layout.html" %}

{% block content %}

<!-- AG Grid Community (CDN) - v33+ Theming API (no legacy CSS themes) -->
<script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>

<!-- Google Font: Noto Sans -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto Sans:wght@400;700&display=swap" rel="stylesheet">

<style type="text/css">

  /* AG Grid selection = yellow text only */
  .ag-grid-host .ag-row-selected,
  .ag-grid-host .ag-row-selected .ag-cell {
    background-color: inherit !important;
  }

  .ag-grid-host .ag-row-selected .ag-cell {
    color: #ffff00 !important;
  }

  /* AG Grid hover highlight = dark */
  .ag-grid-host .ag-row-hover:not(.ag-row-selected) .ag-cell {
    background-color: rgba(0, 0, 0, 0.35) !important;
  }

  /* Dark transaction details table inside modal */
  #descriptionRegexModalDetails table {
    background-color: #1f2328 !important;
    color: #f8f9fa !important;
  }

  /* Use Google Font in the modal dialog */
  #descriptionRegexModal .modal-content,
  #descriptionRegexModal .modal-content * {
    font-family: 'Noto Sans', sans-serif !important;
  }

  #descriptionRegexModalDetails table th,
  #descriptionRegexModalDetails table td {
    background-color: transparent !important;
    color: inherit !important;
    border-color: rgba(255,255,255,0.15) !important;
  }
  
  /* Fit with existing layout + use Google Font */
  .ag-grid-host {
    font-family: 'Noto Sans', serif;
  }

  /* Card headers should match the app font */
  .card .card-header {
    font-family: 'Noto Sans', sans-serif !important;
  }

  /* AG Grid theme CSS sets its own font; override it to match the app font. */
  .ag-grid-host .ag-root-wrapper,
  .ag-grid-host .ag-root-wrapper * {
    font-family: 'Noto Sans', serif !important;
    font-size: inherit !important;
  }

  /* table.dataTable tbody tr.selected {
    color: white;
    background-color: #eeeeee;
} */

/* .transaction_total_table_wrapper.dataTable tbody td {
    color: white;
    background-color: #eeeeee;
} */

  /* .transactions_table.dataTable tbody td {
    vertical-align: middle;
  } */
  /* .table.dataTable td {
    font-size: 1em;
  } */
  /* .table.dataTable {
      font-family: tahoma;
      font-size: 13px;
      direction: rtl;
      position: relative;
      clear: both;
      *zoom: 1;
      zoom: 1;
  } */
  
</style>

<script>

var parseTime = d3.timeParse("%Y-%m-%d %H:%M:%S"), formatShortDate = d3.timeFormat("%Y-%m-%d %H:%M"),formatDate = d3.timeFormat("%Y-%m-%d");
var parseDate = d3.timeParse("%Y-%m-%d");

$(document).ready( function () {

  {
    {
      var objSelect = document.getElementById("myform").period;
      var select = "{{ period or '' }}";
      setSelectedValue(objSelect, select);
    }
    
    {
      var objSelect = document.getElementById("myform").t_type;
      var select = "{{ t_type or '' }}";
      setSelectedValue(objSelect, select);
    }

    // Apply configured table font size to AG Grid containers (avoid Jinja in CSS).
    $('.ag-grid-host').css('font-size', "{{ theme.TABLE_FONT_SIZE }}");

    initGrids();
    SyncData();
  }
});

function SyncData()
{
  loadTotalTable();
  loadSummaryGroupTable();
  setTransactionsFilterLabel(null);
}

// -----------------------------
// AG Grid instances
// -----------------------------
var totalGridApi = null;
var monthGridApi = null;
var classGridApi = null;
var txnGridApi = null;

var _txnContextGroup = null;
var _txnContextMonth = null;

// -----------------------------
// Transactions filter label
// -----------------------------
function _monthFromStartDate(startDate) {
  if (!startDate) return '';
  var s = String(startDate);
  // Expect YYYY-MM-DD; show YYYY-MM
  if (s.length >= 7) return s.slice(0, 7);
  return s;
}

function setTransactionsFilterLabel(parts) {
  var el = document.getElementById('transactionFilterLabel');
  if (!el) return;

  var p = parts || {};
  var groupName = (p.group || '').toString().trim();
  var month = (p.month || '').toString().trim();
  var className = (p.className || '').toString().trim();

  var items = [];
  if (groupName) items.push(groupName);
  if (month) items.push(month);
  if (className) items.push(className);

  el.textContent = items.length ? ('[' + items.join(' - ') + ']') : '';
}

function setGridRows(api, rows) {
  if (!api) return;
  if (typeof api.setRowData === 'function') {
    api.setRowData(rows || []);
    return;
  }
  if (typeof api.setGridOption === 'function') {
    api.setGridOption('rowData', rows || []);
    return;
  }
}

function clearGrid(api) {
  setGridRows(api, []);
}

function fmtAmount(v) {
  var num = (typeof v === 'number') ? v : parseFloat(v);
  if (isNaN(num)) num = 0;
  return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
}

function initGrids() {
  if (typeof agGrid === 'undefined' || (typeof agGrid.createGrid !== 'function' && typeof agGrid.Grid !== 'function')) {
    return;
  }

  // v33+ Theming API: Quartz base + dark color scheme.
  var gridTheme = agGrid.themeQuartz.withPart(agGrid.colorSchemeDark);

  function createGridApi(el, options) {
    if (!el) return null;
    // Prefer legacy constructor when present (avoids theming API conflicts with CSS themes).
    if (typeof agGrid.Grid === 'function') {
      new agGrid.Grid(el, options);
      return options.api || null;
    }
    if (typeof agGrid.createGrid === 'function') {
      // Ensure the theme class on the grid div is used (avoid an inner wrapper div without theme).
      return agGrid.createGrid(el, options, { setThemeOnGridDiv: true });
    }
    return null;
  }

  var defaultColDef = {
    sortable: true,
    resizable: true,
    filter: false
  };

  var totalOptions = {
    theme: gridTheme,
    defaultColDef: defaultColDef,
    rowSelection: 'single',
    suppressCellFocus: true,
    rowData: [],
    columnDefs: [
      { headerName: 'Group', field: 'group', flex: 1 },
      { headerName: 'Amount', field: 'amount', width: 120, valueFormatter: function(p){ return fmtAmount(p.value); } }
    ],
    onRowClicked: function(e) {
      if (!e || !e.data) return;
      // selecting a group resets downstream
      clearGrid(classGridApi);
      clearGrid(txnGridApi);
      _txnContextGroup = e.data.group;
      _txnContextMonth = null;
      loadSummaryGroupTable(e.data.group);
      loadTransactionTable(null, e.data.group, null, null);
    }
  };

  var monthOptions = {
    theme: gridTheme,
    defaultColDef: defaultColDef,
    rowSelection: 'single',
    suppressCellFocus: true,
    rowData: [],
    columnDefs: [
      { headerName: 'Group', field: 'group', width: 140 },
      { headerName: 'Date', field: 'month', width: 110 },
      { headerName: 'Amount', field: 'amount', width: 120, valueFormatter: function(p){ return fmtAmount(p.value); } }
    ],
    onRowClicked: function(e) {
      if (!e || !e.data) return;
      _txnContextGroup = e.data.group;
      _txnContextMonth = e.data.month;
      var dtStart = parseDate(e.data.month + "-01");
      var dtEnd = new Date(dtStart.getFullYear(), dtStart.getMonth() + 1, 0);
      loadSummaryClassTable(e.data.group, formatDate(dtStart), formatDate(dtEnd));
      loadTransactionTable(null, e.data.group, formatDate(dtStart), formatDate(dtEnd));
    }
  };

  var classOptions = {
    theme: gridTheme,
    defaultColDef: defaultColDef,
    rowSelection: 'single',
    suppressCellFocus: true,
    rowData: [],
    columnDefs: [
      { headerName: 'Class', field: 'className', flex: 1 },
      { headerName: 'Date', field: 'month', width: 110 },
      { headerName: 'Amount', field: 'amount', width: 120, sort: 'asc', valueFormatter: function(p){ return fmtAmount(p.value); } }
    ],
    onRowClicked: function(e) {
      if (!e || !e.data) return;
      _txnContextMonth = e.data.month;
      var dtStart = parseDate(e.data.month + "-01");
      var dtEnd = new Date(dtStart.getFullYear(), dtStart.getMonth() + 1, 0);
      loadTransactionTable(e.data.className, _txnContextGroup, formatDate(dtStart), formatDate(dtEnd));
    }
  };

  var txnOptions = {
    theme: gridTheme,
    defaultColDef: defaultColDef,
    rowSelection: 'single',
    suppressCellFocus: true,
    rowData: [],
    columnDefs: [
      { headerName: 'ID', field: 'id', width: 90, hide: true },
      { headerName: 'Date', field: 'date', width: 120 },
      { headerName: 'Description', field: 'description', flex: 1, minWidth: 200 },
      { headerName: 'Amount', field: 'amount', width: 120, sort: 'asc', valueFormatter: function(p){ return fmtAmount(p.value); } },
      { headerName: 'Class', field: 'className', width: 140 },
      { headerName: 'Group', field: 'groupName', width: 140 },
      { headerName: 'Source', field: 'source', width: 140 },
      { headerName: 'Type', field: 'type', width: 140 }
    ],
    onRowClicked: function(e) {
      if (!e || !e.data) return;
      // modal expects the legacy array order
      var legacyRow = [
        e.data.id,
        e.data.date,
        e.data.description,
        e.data.amount,
        e.data.className,
        e.data.groupName,
        e.data.source,
        e.data.type
      ];
      showDescriptionRegexModal(legacyRow);
    }
  };

  var totalEl = document.getElementById('transaction_total_grid');
  var monthEl = document.getElementById('transaction_summary_group_grid');
  var classEl = document.getElementById('transaction_summary_class_grid');
  var txnEl = document.getElementById('transaction_grid');

  totalGridApi = createGridApi(totalEl, totalOptions);
  monthGridApi = createGridApi(monthEl, monthOptions);
  classGridApi = createGridApi(classEl, classOptions);
  txnGridApi = createGridApi(txnEl, txnOptions);
}

// -----------------------------
// Description regex modal helpers
// -----------------------------
var _descriptionRegexModalInstance = null;

function getDescriptionRegexModalInstance() {
  if (_descriptionRegexModalInstance != null) {
    return _descriptionRegexModalInstance;
  }
  var el = document.getElementById('descriptionRegexModal');
  if (!el || typeof bootstrap === 'undefined' || !bootstrap.Modal) {
    return null;
  }
  _descriptionRegexModalInstance = new bootstrap.Modal(el);
  return _descriptionRegexModalInstance;
}

function escapeRegexLiteral(s) {
  if (s == null) return '';
  return String(s).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

async function copyTextToClipboard(text) {
  if (!text) return false;
  if (navigator.clipboard && window.isSecureContext) {
    await navigator.clipboard.writeText(text);
    return true;
  }
  var ta = document.createElement('textarea');
  ta.value = text;
  ta.setAttribute('readonly', '');
  ta.style.position = 'absolute';
  ta.style.left = '-9999px';
  document.body.appendChild(ta);
  ta.select();
  ta.setSelectionRange(0, ta.value.length);
  var ok = false;
  try {
    ok = document.execCommand('copy');
  } catch (e) {
    ok = false;
  }
  document.body.removeChild(ta);
  return ok;
}

async function onCopyDescriptionRegexJson() {
  var pre = document.getElementById('descriptionRegexModalPre');
  var btn = document.getElementById('descriptionRegexCopyBtn');
  if (!pre) return;
  try {
    if (btn) {
      btn.disabled = true;
      btn.innerText = 'Copying...';
    }
    var ok = await copyTextToClipboard(pre.innerText || pre.textContent || '');
    if (btn) {
      btn.innerText = ok ? 'Copied' : 'Copy failed';
      setTimeout(function() {
        btn.innerText = 'Copy';
        btn.disabled = false;
      }, 1200);
    }
  } catch (e) {
    if (btn) {
      btn.innerText = 'Copy failed';
      btn.disabled = false;
    }
  }
}

var _lastTransactionModalDescription = '';

function searchTransactionDescriptionOnGoogle() {
  var q = (_lastTransactionModalDescription || '').toString().trim();
  if (!q) return;
  var url = 'https://www.google.com/search?q=' + encodeURIComponent(q);
  window.open(url, '_blank', 'noopener');
}

function formatTxnAmount(v) {
  var num = (typeof v === 'number') ? v : parseFloat(v);
  if (isNaN(num)) num = 0;
  return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
}

function buildTransactionDetailTableHtml(row) {
  var r = row || [];
  var id = r[0];
  var date = r[1];
  var desc = r[2];
  var amount = r[3];
  var cls = r[4];
  var grp = r[5];
  var src = r[6];
  var typ = r[7];

  var html = '';
  html += '<table class="table table-sm mb-2">';
  html += '<tbody>';
  html += '<tr><th style="width:120px;">ID</th><td>' + (id == null ? '' : id) + '</td></tr>';
  html += '<tr><th>Date</th><td>' + (date == null ? '' : date) + '</td></tr>';
  html += '<tr><th>Description</th><td>' + (desc == null ? '' : desc) + '</td></tr>';
  html += '<tr><th>Amount</th><td>' + formatTxnAmount(amount) + '</td></tr>';
  html += '<tr><th>Class</th><td>' + (cls == null ? '' : cls) + '</td></tr>';
  html += '<tr><th>Group</th><td>' + (grp == null ? '' : grp) + '</td></tr>';
  html += '<tr><th>Source</th><td>' + (src == null ? '' : src) + '</td></tr>';
  html += '<tr><th>Type</th><td>' + (typ == null ? '' : typ) + '</td></tr>';
  html += '</tbody>';
  html += '</table>';
  return html;
}

function showDescriptionRegexModal(row) {
  var titleEl = document.getElementById('descriptionRegexModalTitle');
  var detailsEl = document.getElementById('descriptionRegexModalDetails');
  var preEl = document.getElementById('descriptionRegexModalPre');
  var copyBtn = document.getElementById('descriptionRegexCopyBtn');

  var desc = '';
  if (Array.isArray(row)) {
    desc = (row[2] || '').toString().trim();
  } else {
    desc = (row || '').toString().trim();
  }
  _lastTransactionModalDescription = desc;

  var regex = desc ? ('.*' + escapeRegexLiteral(desc) + '.*') : '.*';
  var payload = { regex: regex };
  var jsonText = JSON.stringify(payload, null, 2) + ',';

  if (titleEl) titleEl.innerText = 'Transaction detail';
  if (detailsEl) {
    detailsEl.innerHTML = buildTransactionDetailTableHtml(row);
  }
  if (preEl) preEl.textContent = jsonText;
  if (copyBtn) {
    copyBtn.innerText = 'Copy';
    copyBtn.disabled = false;
  }

  var modal = getDescriptionRegexModalInstance();
  if (modal) modal.show();
}

function loadTotalTable() {
  var t_period = getSelectedValue(document.getElementById('myform').period);
  var trans_type = getSelectedValue(document.getElementById('myform').t_type);

  return d3.json('api/transaction_total', {
    method: 'POST',
    body: JSON.stringify({ period: t_period, t_type: trans_type }),
    headers: {
      'Content-type': 'application/json; charset=UTF-8',
      'Authorization': 'Bearer ' + getCookie('access-token')
    }
  }).then(function(data_json) {
    var rows = (data_json && data_json['results'] ? data_json['results'] : []).map(function(r) {
      return { group: r[0], amount: +r[1] };
    });
    setGridRows(totalGridApi, rows);
  });
}

function loadSummaryGroupTable(group_filter) {
  if (typeof group_filter === 'undefined') group_filter = null;

  var t_period = getSelectedValue(document.getElementById('myform').period);
  var trans_type = getSelectedValue(document.getElementById('myform').t_type);

  return d3.json('api/transaction_summary', {
    method: 'POST',
    body: JSON.stringify({ period: t_period, t_type: trans_type, t_group: group_filter, group_by: 'group' }),
    headers: {
      'Content-type': 'application/json; charset=UTF-8',
      'Authorization': 'Bearer ' + getCookie('access-token')
    }
  }).then(function(data_json) {
    var rows = (data_json && data_json['results'] ? data_json['results'] : []).map(function(r) {
      return { group: r[0], month: r[1], amount: +r[2] };
    });
    setGridRows(monthGridApi, rows);
  });
}

function loadSummaryClassTable(group_filter, start_date, end_date) {
  if (typeof group_filter === 'undefined') group_filter = null;
  if (typeof start_date === 'undefined') start_date = null;
  if (typeof end_date === 'undefined') end_date = null;

  var t_period = getSelectedValue(document.getElementById('myform').period);
  var trans_type = getSelectedValue(document.getElementById('myform').t_type);

  return d3.json('api/transaction_summary', {
    method: 'POST',
    body: JSON.stringify({
      period: t_period,
      t_type: trans_type,
      t_group: group_filter,
      group_by: 'class',
      start_date: start_date,
      end_date: end_date
    }),
    headers: {
      'Content-type': 'application/json; charset=UTF-8',
      'Authorization': 'Bearer ' + getCookie('access-token')
    }
  }).then(function(data_json) {
    var rows = (data_json && data_json['results'] ? data_json['results'] : []).map(function(r) {
      return { className: r[0], month: r[1], amount: +r[2] };
    });
    setGridRows(classGridApi, rows);
  });
}

function loadTransactionTable(class_filter, group_filter, start_date, end_date) {
  if (typeof class_filter === 'undefined') class_filter = null;
  if (typeof group_filter === 'undefined') group_filter = null;
  if (typeof start_date === 'undefined') start_date = null;
  if (typeof end_date === 'undefined') end_date = null;

  var t_period = getSelectedValue(document.getElementById('myform').period);
  var trans_type = getSelectedValue(document.getElementById('myform').t_type);

  console.log(JSON.stringify({
    period: t_period,
    t_type: trans_type,
    t_class: class_filter,
    t_group: group_filter,
    start_date: start_date,
    end_date: end_date
  }));

  return d3.json('api/transaction_search', {
    method: 'POST',
    body: JSON.stringify({
      period: t_period,
      t_type: trans_type,
      t_class: class_filter,
      t_group: group_filter,
      start_date: start_date,
      end_date: end_date
    }),
    headers: {
      'Content-type': 'application/json; charset=UTF-8',
      'Authorization': 'Bearer ' + getCookie('access-token')
    }
  }).then(function(data_json) {
    var rows = (data_json && data_json['results'] ? data_json['results'] : []).map(function(r) {
      return {
        id: r[0],
        date: r[1],
        description: r[2],
        amount: +r[3],
        className: r[4],
        groupName: r[5],
        source: r[6],
        type: r[7]
      };
    });
    setGridRows(txnGridApi, rows);

    setTransactionsFilterLabel({
      group: group_filter || _txnContextGroup,
      month: _monthFromStartDate(start_date) || (_txnContextMonth || ''),
      className: class_filter
    });
  });
}

function sanitizeTsvCell(v) {
  if (v == null) return '';
  return String(v).replace(/\t/g, ' ').replace(/\r?\n/g, ' ').trim();
}

function buildTransactionTableTsv() {
  if (!txnGridApi) return '';
  var header = ['ID', 'Date', 'Description', 'Amount', 'Class', 'Group', 'Source', 'Type'];
  var lines = [header.join('\t')];

  var iter = (typeof txnGridApi.forEachNodeAfterFilterAndSort === 'function')
    ? txnGridApi.forEachNodeAfterFilterAndSort.bind(txnGridApi)
    : (typeof txnGridApi.forEachNode === 'function' ? txnGridApi.forEachNode.bind(txnGridApi) : null);

  if (iter) {
    iter(function(node) {
      if (!node || !node.data) return;
      var d = node.data;
      lines.push([
        sanitizeTsvCell(d.id),
        sanitizeTsvCell(d.date),
        sanitizeTsvCell(d.description),
        sanitizeTsvCell(fmtAmount(d.amount)),
        sanitizeTsvCell(d.className),
        sanitizeTsvCell(d.groupName),
        sanitizeTsvCell(d.source),
        sanitizeTsvCell(d.type)
      ].join('\t'));
    });
  }
  return lines.join('\n');
}

async function copyTransactionTableToClipboard() {
  var btn = document.getElementById('transactionCopyBtn');
  try {
    var tsv = buildTransactionTableTsv();
    if (!tsv) {
      if (btn) btn.innerText = 'No rows';
      return;
    }
    if (btn) {
      btn.disabled = true;
      btn.innerText = 'Copying...';
    }
    var ok = await copyTextToClipboard(tsv);
    if (btn) {
      btn.innerText = ok ? 'Copied' : 'Copy failed';
      setTimeout(function() {
        btn.innerText = 'Copy';
        btn.disabled = false;
      }, 1200);
    }
  } catch (e) {
    if (btn) {
      btn.innerText = 'Copy failed';
      btn.disabled = false;
    }
  }
}

</script>

<!-- Description regex modal (shown when clicking a row in the Transactions table) -->
<div class="modal fade" id="descriptionRegexModal" tabindex="-1" aria-labelledby="descriptionRegexModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content {{ CARD_CLASS }}">
      <div class="modal-header">
        <h5 class="modal-title" id="descriptionRegexModalTitle">Transaction detail</h5>
        <div class="d-flex align-items-center ms-auto">
          <button type="button" class="btn btn-outline-secondary btn-sm" id="descriptionRegexSearchBtn" onclick="searchTransactionDescriptionOnGoogle()">Search</button>
          <button type="button" class="btn-close ms-2" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
      </div>
      <div class="modal-body">
        <div id="descriptionRegexModalDetails"></div>
        <hr class="my-2" />
        <div class="d-flex align-items-center">
          <div class="flex-grow-1 fw-semibold">JSON snippet</div>
          <button type="button" class="btn btn-outline-secondary btn-sm" id="descriptionRegexCopyBtn" onclick="onCopyDescriptionRegexJson()">Copy</button>
        </div>
        <pre id="descriptionRegexModalPre" class="mb-0 mt-2" style="white-space:pre-wrap;word-break:break-word;"></pre>
      </div>
    </div>
  </div>
</div>

<!-- <centre><h2>Transaction Summary</h2></centre> -->

<form method="get" _lpchecked="1" id="myform">
  <fieldset>
<div class="form-group row">
<!-- <div class="col-3" style="width:100px;">
      <label for="duration" class="form-label">Period</label>
  </div> -->
  <div class="col-3" style="width:150px">
    <div class="form-outline">
      <select class="form-control" name="period" onchange="this.form.submit()">
        <option>1 Month</option>
        <option>3 Months</option>
        <option>6 Months</option>
        <option selected>12 Months</option>
        <option>24 Months</option>
        <option>All</option>
      </select>
    </div>
  </div>

  <div class="col-3" style="width:180px">
    <div class="form-outline">
      <select class="form-control" name="t_type" onchange="this.form.submit()">
        <option selected>Debit Normal</option>
        <option>Credit Normal</option>
        <option>Debit Abnormal</option>
        <option>Credit Abnormal</option>
      </select>
    </div>
  </div>

  <!-- <div class="col-3">
     <button type="submit" class="btn btn-primary" name="action" value="refresh">Refresh</button>
  </div> -->
</div>
</fieldset>
</form>
<!-- <form method="get" _lpchecked="1" id="myform">
  <fieldset>
    <div class="form-group row">
      <div class="col-md-4" style="width:220px">
          <label for="name" class="form-label">Name</label>
          <input class="input-control" name="name" onchange="this.form.submit()">
      </div>

    </div>
  </fieldset>
</form> -->

<div class="row g-2">

  <div class="col-lg-3 col-md-4">
    <div class="card {{ CARD_CLASS }} mb-2">
      <div class="card-header">Group Total</div>
      <div class="card-body">
        <div id="transaction_total_grid" class="ag-grid-host" style="width:100%;height:400px;"></div>
      </div>
    </div>
  </div>

  <div class="col-lg-5 col-md-4">
    <div class="card {{ CARD_CLASS }} mb-2">
      <div class="card-header">Group By Month</div>
      <div class="card-body">
        <div id="transaction_summary_group_grid" class="ag-grid-host" style="width:100%;height:400px;"></div>
      </div>
    </div>
  </div>

  <div class="col-lg-4 col-md-4">
    <div class="card {{ CARD_CLASS }} mb-2">
      <div class="card-header">Class Total</div>
      <div class="card-body">
        <div id="transaction_summary_class_grid" class="ag-grid-host" style="width:100%;height:400px;"></div>
      </div>
    </div>
  </div>

</div>

<div class="row mt-2">
  <div class="col-12">
    <div class="card {{ CARD_CLASS }} mb-2">
      <div class="card-header d-flex align-items-center">
        <div class="flex-grow-1">
          <span>Transactions:</span>
          <span class="ms-2" id="transactionFilterLabel" style="color:inherit;"></span>
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="transactionCopyBtn" onclick="copyTransactionTableToClipboard()">Copy</button>
      </div>
      <div class="card-body">
        <div id="transaction_grid" class="ag-grid-host" style="width:100%;height:600px;"></div>
      </div>
    </div>
  </div>
</div>



{% endblock %}